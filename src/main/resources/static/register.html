<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>图书管理系统</title>
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
</head>
<body>
<h1>注册</h1>
<input style="width:200px" type="text" value="" id="email" placeholder="请输入有效邮箱"/><button type="button" onclick="checkemail()">发送验证码</button><br/>
<input style="width:200px" type="text" value="" id="checkcode" placeholder="请输入验证码"/><button type="button" onclick="checkcode()">验证验证码</button><br/>
<input style="width:200px" type="text" value="" id="password" placeholder="请输入密码"/><br/>
<button type="button" onclick="register()">注册</button><br/><br/>

<script type="text/javascript">
    var code = "";
    function checkemail() {
        var email = $("#email").val();
        $.ajax({
            type:"POST",
            url:"http://localhost:8080/register/checkcode",
            data:{
                email:email
            },
            dataType:"json",
            success:function(result){
                alert("请求成功");
                console.log(result);
                /*
                if(result == "fail"){
                    alert("邮箱已经被注册，请重新输入!")
                }
                else{
                    alert("邮箱可以使用!")
                    //var checkcode = $("#checkcode").val();
                    code = result;
                }
                */
            },
            error:function (err) {
                alert("请求失败");
                console.log(err);
            }
        });
    }

    function checkcode(){
        var checkcode = $("#checkcode").val();
        if (code == checkcode){
            alert("验证码正确!");
        }
        else{
            alert("验证码错误，请输入正确的验证码!");
        }
    }

    function register(){
        var checkcode = $("#checkcode").val();
        if (code != checkcode){
            alert("请输入正确的验证码!");
        }
        else{
            var email = $("#email").val();
            var password = $("#password").val();
            $.ajax({
                type:"POST",
                url:"http://localhost:8080/register",
                data:{
                    email:email,
                    password:password
                },
                dataType:"json",
                success:function(result){
                    if (result){
                        alert("注册成功，点击确定即可跳转到登录页!");
                        window.open("index.html","_self");
                    }
                }
            });
        }

    }
</script>
</body>
</html>