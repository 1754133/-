<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Query</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
</head>
<body>

<div id="mainbox"><center>
    <b>书目信息</b><br/><br/>
    <table width="800">
        <tr>
            <th width="200">书名:</th>
            <th id="bookname"></th>
        </tr>
        <tr>
            <th width="200">作者:</th>
            <th id="author"></th>
        </tr>
        <tr>
            <th width="200">出版社：</th>
            <th id="press"></th>
        </tr>
        <tr>
            <th width="200">书架号：</th>
            <th id="shelfId"></th>
        </tr>
        <tr>
            <th width="200">类别：</th>
            <th id="type"></th>
        </tr>
        <tr>
            <th width="200">ISBN:</th>
            <th id="isbn"></th>
        </tr>
        <tr>
            <th width="200">简介:</th>
            <th id="synopsis"></th>
        </tr>
        <tr>
            <th width="200">库存：</th>
            <th id="remain"></th>
        </tr>
    </table><br/><br/>
    <div id="button"></div>
</center>
</div>

<script type="text/javascript">
    var bookId = getCookie("bookId")
    var userId=getCookie("id")
    function getCookie(cname){
        var name= cname+"=";
        var ca=document.cookie.split(';');
        for(var i=0;i<ca.length;i++){
            var c=ca[i].trim();
            if(c.indexOf(name)==0)
                return c.substring(name.length,c.length);
        }
        return "";
    }
    console.log(bookId)
    console.log(userId)
    var canborrow
    $.ajax({
        type:"GET",
        url:"http://localhost:8080/borrow/borrowinfo/"+bookId+"/"+userId,
        dataType:"json",
        success:function (result) {
            console.log(result)
            if(result==false){
                canborrow=0
            }
            if(result==true){
                canborrow=1
            }
        }
        }
    )

    $.ajax({
        type:"GET",
        url:"http://localhost:8080/books/" + bookId,
        dataType:"json",
        success:function (result) {
            console.log(result)
            document.getElementById("bookname").innerText = result.name
            document.getElementById("author").innerText=result.author
            document.getElementById("press").innerText=result.press
            document.getElementById("shelfId").innerText=result.shelfId
            document.getElementById("type").innerText=result.type
            document.getElementById("synopsis").innerText=result.synopsis
            document.getElementById("remain").innerText=result.remain
            document.getElementById("isbn").innerText=result.isbn
            if(canborrow==0)
            {
                var _button="<a class= \"button black\" disabled=\"disabled\">已借阅</a>\n"
            }
            else if(result.remain==0){
                var _button="<a class=\"button black\" onclick=\"Reserve("+bookId+")\">预定</a>\n"
            }
            else{
                var _button="<a class=\"button black\" onclick=\"Borrow("+bookId+")\">借书</a>\n"
            }
            $("#button").html(_button);
        }
    })

    function Borrow(bookId) {
        console.log(bookId)
        console.log(userId)
        $.ajax({
            type:"POST",
            url:"http://localhost:8080/borrow/borrowinfo",
            data:{
                bookId:bookId,
                userId:userId
            },
            dataType:"json",
            async:false
        });
        location.reload();
    }

    function Reserve(bookId) {

    }

</script>
</body>
</html>