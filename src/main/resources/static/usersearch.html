<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<div class="header">
    <h1>欢迎使用管理员系统</h1>
</div>

<div class="navbar">
    <a href="index.html">返回主页</a>
    <a href="#" class="right">帮助</a>
    <a href="index.html" class="right">注销</a>
</div>
<body>
<ul>
    <li><a href="manage.html">查询图书信息</a></li>
    <li><a class="active" href="usersearch.html">查询读者信息</a></li>
    <li><a href="addbook.html">添加图书</a></li>
    <li><a href="queryuserborrow.html">查询读者借阅</a></li>
</ul>
<div style="margin-left:15%;padding:1px 16px;height:1000px;"><center>
<div id="manage">
    <br/><br/>
    <p>请输入要查询的用户的邮箱:</p><br/>
    <input style="width:400px;height:40px" type="text" id="email"/><br/><br/><br/>
    <a class="button black" onclick="query()">用户搜索</a><br/><br/>
    <center>

        <table id="userinfo" width="400" hidden>
            <tr style="height: 30px">
                <th width="200">邮箱:</th>
                <th id="e-mail"></th>
            </tr>
            <tr style="height: 30px">
                <th width="200">姓名:</th>
                <th id="name"></th>
            </tr>
            <tr style="height: 30px">
                <th width="200">性别：</th>
                <th id="sex"></th>
            </tr>
            <tr style="height: 30px">
                <th width="200">年龄：</th>
                <th id="age"></th>
            </tr>
            <tr style="height: 30px">
                <th width="200">账号状态：</th>
                <th id="con"></th>
            </tr>
            <tr style="height: 30px"></tr><tr></tr>
            <tr>
                <th id="deletebutton"></th>
                <th id="clockbutton"></th>
            </tr>
        </table>
    </center>

</div></center></div>
<script type="text/javascript">
    function query() {
        var email=$("#email").val();
        console.log(email)
        $.ajax({
            type:"GET",
            url:"http://localhost:8080/users/email/" + email,
            dateType:"json",
            success:function (result) {
                console.log(result)
                if(result=="")
                {
                    alert("该用户不存在。")
                }
                else{
                createlist(result)}
            }
        })
    }
    function createlist(data) {
        document.getElementById("e-mail").innerText = data.email
        document.getElementById("name").innerText=data.name
        document.getElementById("sex").innerText=data.sex
        document.getElementById("age").innerText=data.age
        var butt=""
        butt="<a class=\"button black\" onclick=\"deleteuser("+data.id+")\">删除用户</a>"
        $("#deletebutton").html(butt);
        if(data.ifBanned)
        {
            document.getElementById("con").innerText="已封禁"
            butt="<a class=\"button black\" onclick=\"lockuser("+data.id+")\">解封用户</a>"
            $("#clockbutton").html(butt);
        }
        else{
            document.getElementById("con").innerText="正常"
            butt="<a class=\"button black\" onclick=\"lockuser("+data.id+")\">封禁用户</a>"
            $("#clockbutton").html(butt);
        }
        $("#userinfo").show();
    }
    function deleteuser(id) {
        var r=confirm("您确定要刪除该用戶吗？")
        if(r){
            $.ajax({
                type:"DELETE",
                url:"http://localhost:8080/users/"+id,
                dataType:"json"
            })
            alert("删除成功。")
            location.reload()
        }
        else{

        }
    }
    function lockuser(id) {
        $.ajax({
            type:"PUT",
            url:"http://localhost:8080/users/"+id,
            dataType:"json"
        })
        location.reload()
    }

</script>
</body>
</html>